services:
  main-rproxy:
    image: traefik:v3.1
    command:
      - --accesslog=true
      - --log.level=INFO
      - --providers.docker
      - --providers.docker.network=web
      - --providers.docker.exposedbydefault=false
      - --global.checknewversion=false
      - --global.sendanonymoususage=false
    ports:
      - 80:80
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
    networks:
      - web

  whoami-proxy:
    image: nginx
    labels:
      traefik.enable: true
      traefik.http.routers.whoami.rule: Host(`whoami.docker.localhost`)
    volumes:
      - ./nginx/default.conf:/etc/nginx/conf.d/default.conf:ro
    networks:
      - web
      - private

  whoami:
    image: traefik/whoami
    networks:
      - private

  jailed-worker:
    image: nicolaka/netshoot
    command: sleep 6000
    init: true
    networks:
      - private

networks:
  web:
    name: web
  private:
    name: private
    internal: true
